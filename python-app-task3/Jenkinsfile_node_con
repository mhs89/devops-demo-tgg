pipeline {
  agent {
    node { label 'sicakyuz-virtualbox' }  // Jenkins makinesine direkt olarak bağlanır
  }
  stages {
    stage('Checkout Code') {
      steps {
        git branch: 'main', credentialsId: 'b9e78042-af07-41f8-b5e8-be4bd9f37cad', url: 'git@github.com:mhs89/Docker-Build.git'
      }
    }
    stage('Build Docker Image') {
      steps {
        script {
          // Docker imajını oluştur ve etiketle
          sh 'docker build -t sicakyuz/custom-python-image:latest -f Dockerfile .'
        }
      }
    }
    stage('Push Docker Image to Docker Hub') {
      steps {
        script {
          // Docker Hub'a giriş yap
          withCredentials([usernamePassword(credentialsId: 'docker-hub-credentials', usernameVariable: 'DOCKERHUB_USERNAME', passwordVariable: 'DOCKERHUB_PASSWORD')]) {
            sh "docker login -u ${DOCKERHUB_USERNAME} -p ${DOCKERHUB_PASSWORD}"
          }
          // Docker imajını Docker Hub'a it
          sh 'docker push sicakyuz/custom-python-image:latest'
        }
      }
    }
    stage('Deploy to Kubernetes Cluster') {
      steps {
        script {
          // Kubernetes manifestini uygula veya varolan bir dağıtımı güncelle
          sh 'kubectl set image deployment/python-app python-con=sicakyuz/custom-python-image:latest'
          // veya
          // sh 'kubectl apply -f your-kubernetes-manifest.yaml'
        }
      }
    }
  }
}